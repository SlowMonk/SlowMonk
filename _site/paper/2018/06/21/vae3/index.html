<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v6.4.0 (https://qwtel.com/hydejack/)
-->









<head>
  <!-- =============== -->
<!-- META            -->
<!-- =============== -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="format-detection" content="telephone=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="naver-site-verification" content="22c5b4ef3bfda7fc6100671413989219de7a4ac8"/>
<meta property="og:title" content="VAE Tutorial 3">
<meta property="og:type" content="article">





  <meta property="og:image" content="http://localhost:4003/assets/img/logo.png">


<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="360" />



  <title>VAE Tutorial 3 &middot; Woongwon Lee</title>



<meta name="description" content="
  VAE Tutorial 목차
    
      Tutorial 1: CS231n 강의 내용
      Tutorial 2: VAE 논문 &amp; 코드 리뷰
      Tutorial 3: SentenceVAE
      Tutorial 4: MusicVAE
    
  


">
<meta property="og:description" content="
  VAE Tutorial 목차
    
      Tutorial 1: CS231n 강의 내용
      Tutorial 2: VAE 논문 &amp; 코드 리뷰
      Tutorial 3: SentenceVAE
      Tutorial 4: MusicVAE
    
  


">



<!-- =============== -->
<!-- LINKS           -->
<!-- =============== -->
<link rel="canonical" href="http://localhost:4003/paper/2018/06/21/vae3/">
<meta property="og:url" content="http://localhost:4003/paper/2018/06/21/vae3/">

<link rel="alternate" type="application/atom+xml" title="Woongwon Lee Feed" href="http://localhost:4003/feed.xml">


  <link rel="prev" href="http://localhost:4003/paper/2018/06/20/vae2/">



  <link rel="next" href="http://localhost:4003/paper/2018/06/21/vae4/">


<link rel="apple-touch-icon" href="http://localhost:4003/apple-touch-icon.png">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
<!-- Place favicon.ico in the root directory -->

<!-- =============== -->
<!-- SCRIPTS         -->
<!-- =============== -->
<script>
  !function(n,e){function t(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function o(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}n._loaded=!1,n.loadJSDeferred=function(a,d){function r(){n._loaded=!0;var r=e.createElement("script");r.src=a,d&&(("onload"in r?t:o)(r,d),r.onload||t(r,d));var l=e.getElementsByTagName("script")[0];l.parentNode.insertBefore(r,l)}n._loaded?r():n.addEventListener?n.addEventListener("load",r,!1):n.attachEvent?n.attachEvent("onload",r):n.onload=r}}(window,document);

  !function(e){"use strict";var n=function(n,t,o){function i(e){if(a.body)return e();setTimeout(function(){i(e)})}function r(){l.addEventListener&&l.removeEventListener("load",r),l.media=o||"all"}var d,a=e.document,l=a.createElement("link");if(t)d=t;else{var f=(a.body||a.getElementsByTagName("head")[0]).childNodes;d=f[f.length-1]}var s=a.styleSheets;l.rel="stylesheet",l.href=n,l.media="only x",i(function(){d.parentNode.insertBefore(l,t?d:d.nextSibling)});var u=function(e){for(var n=l.href,t=s.length;t--;)if(s[t].href===n)return e();setTimeout(function(){u(e)})};return l.addEventListener&&l.addEventListener("load",r),l.onloadcssdefined=u,u(r),l};"undefined"!=typeof exports?exports.loadCSS=n:e.loadCSS=n}("undefined"!=typeof global?global:this);

  !function(t){if(t.loadCSS){var e=loadCSS.relpreload={};if(e.support=function(){try{return t.document.createElement("link").relList.supports("preload")}catch(t){return!1}},e.poly=function(){for(var e=t.document.getElementsByTagName("link"),r=0;r<e.length;r++){var n=e[r];"preload"===n.rel&&"style"===n.getAttribute("as")&&(t.loadCSS(n.href,n,n.getAttribute("media")),n.rel=null)}},!e.support()){e.poly();var r=t.setInterval(e.poly,300);t.addEventListener&&t.addEventListener("load",function(){e.poly(),t.clearInterval(r)}),t.attachEvent&&t.attachEvent("onload",function(){t.clearInterval(r)})}}}(this);

  window.disablePushState = false;
  window.disableDrawer = false;
</script>
<!--
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5105555504153863",
    enable_page_level_ads: true
  });
</script>
-->
<!--[if lt IE 9]>
<script src="https://unpkg.com/html5shiv/dist/html5shiv.min.js"></script>
<![endif]-->

<!-- =============== -->
<!-- STYLES          -->
<!-- =============== -->
<!--[if gt IE 8]><!---->
<style>
  
  article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-size:16px;line-height:1.75}body{color:#333;background-color:#fff;overflow-y:scroll}a{text-decoration:none}.lead{margin-left:-1rem;margin-right:-1rem}img,.img{display:block;max-width:100%;margin-bottom:1rem;border:none}img.lead,.img.lead{max-width:calc(100% + 2rem);width:calc(100% + 2rem)}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-weight:bold;text-rendering:optimizeLegibility}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6{margin:1.6rem 0 1rem;line-height:1.6}h1,.h1{font-size:2rem;line-height:1.25}h2,.h2{font-size:1.5rem}h3,.h3{font-size:1.17em}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.25rem;font-weight:300;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #eee}.hr{padding-bottom:.5rem;border-bottom:1px solid #eee;margin-bottom:1.5rem}h4,h5,h6,.h4,.h5,.h6{margin-bottom:0.5rem;font-size:1rem}table{margin-bottom:1rem;width:100%;width:calc(100% + 2rem);margin-left:-1rem;border:1px solid #e5e5e5;border-collapse:collapse;border-spacing:0}td,th{padding:.25rem .5rem;border:1px solid #e5e5e5}td:first-child,th:first-child{padding-left:1rem}td:last-child,th:last-child{padding-right:1rem}thead+tbody,tbody+tbody,tfoot{border-top:3px double #e5e5e5}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#f9f9f9}footer{margin-bottom:2rem}.page,.post{margin-bottom:3em}.page li+li,.post li+li{margin-top:.25rem}.page>header,.post>header{margin-bottom:2rem}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-0.5rem;margin-bottom:1rem;color:#9a9a9a}.related-posts{padding-left:0;list-style:none}.related-posts>li,.related-posts>li+li{margin-top:1rem}.related-posts>li>small,.related-posts>li+li>small{font-size:75%;color:#9a9a9a}.message{margin-bottom:1rem;padding:1rem;color:#787878;background-color:#f9f9f9;margin-left:-1rem;margin-right:-1rem}body,main{position:relative;overflow-x:hidden}@media screen{body::before{content:'';background:#e5e5e5;position:absolute;left:0;top:0;bottom:0}}@media screen and (min-width: 40em){html{font-size:17px}}@media screen and (min-width: 54em){html{font-size:16px}}@media screen and (min-width: 88em){html{font-size:17px}}@media screen and (min-width: 125em){html{font-size:18px}}.sr-only{display:none}.clearfix,.sidebar-social::after,.clearafter::after{content:"";display:table;clear:both}a,.a{position:relative;padding-bottom:.15rem;border-style:hidden}.img{overflow:hidden;background-color:#f9f9f9}.img>img{margin:0;width:100%;height:100%}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}h1+hr,h2+hr,h3+hr,h4+hr,h5+hr,h6+hr{margin-top:0}.fade-in{animation-duration:500ms;animation-name:fade-in;animation-fill-mode:forwards}@keyframes fade-in{from{transform:translateY(-2rem);opacity:0}50%{transform:translateY(-2rem);opacity:0}to{transform:translateY(0);opacity:1}}.mb6{margin-bottom:10rem}.sidebar{color:rgba(255,255,255,0.75);text-align:left}.sidebar::before{content:"";position:absolute;z-index:2;top:0;left:0;bottom:0;right:0;background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 100%)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2)}.right-side{width:100%;margin-left:auto;margin-right:auto}.right-side .ad-first{text-align:center}.right-side .ad-second{text-align:center}@media screen{.right-side{max-width:38rem;min-height:100vh}}@media screen and (min-width: 54em){.right-side{margin-left:20rem;margin-right:1rem;padding:4rem 1rem 12rem}}@media screen and (min-width: 72em){.right-side{margin-left:22rem;max-width:42rem}}@media screen and (min-width: 88em){.right-side{width:162px;margin-left:0rem;margin-right:0rem;padding:0rem;margin-top:10rem;display:block;float:left}}@media screen and (min-width: 96em){.right-side{width:300px;margin-right:0rem}}#_yDrawer{position:relative}@media screen{#_yDrawer{min-height:640px;min-height:100vh}}@media screen and (min-width: 54em){#_yDrawer{width:18rem;margin-left:0}}.sidebar-bg{position:absolute;height:100%;overflow:hidden;top:0;right:0;bottom:0;left:0;background:#202020 center / cover}.sidebar-box{display:flex;justify-content:center}.sidebar-sticky{position:relative;z-index:3}@media screen{.sidebar-sticky{-ms-overflow-style:none;overflow:-moz-scrollbars-none;height:100%;overflow:auto;position:absolute;padding:3rem 0rem;right:2.5rem;left:2.5rem}}.sidebar-sticky::-webkit-scrollbar{display:none}.sidebar-about>h1{color:#fff;font-size:2rem}.sidebar-nav>ul{list-style:none;padding-left:0;margin-bottom:.5rem}a.sidebar-nav-item{width:100%;font-weight:normal;display:block;line-height:1.75;padding:.25rem 0;border-bottom:1px solid rgba(255,255,255,0.2)}a.sidebar-nav-subitem{font-weight:normal;display:block;line-height:1.75;padding:.25rem 0;border-bottom:1px solid rgba(255,255,255,0.2)}@media screen{.y-drawer-scrim{z-index:2}.y-drawer-content{width:18rem;left:-18rem;z-index:3}}.sidebar-social{margin-bottom:.5rem}.sidebar-social>ul{list-style:none;padding-left:0;margin:0 -.25rem}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.6rem;line-height:3rem;width:3.1249rem;height:4rem;padding:.5rem 0}.sidebar-social>ul li+li{margin-top:0}.fixed-top{position:fixed;top:0;left:0;width:100%;z-index:1}.navbar>.content{padding-top:0;padding-bottom:0;min-height:0;height:0}.menu{display:inline-block;padding:1.75rem 1.5rem;border-bottom:none;margin-left:-1.5rem;color:#9a9a9a !important}.menu::after{content:"\2630"}@media screen and (min-width: 54em){.menu{padding:1.25rem 1.5rem;position:absolute;left:-9999px}.menu:focus{position:static}}.animation-main{pointer-events:none}.loading{display:none}@media print{.menu{display:none}}.animation-main{opacity:0;will-change:opacity}.loading{position:absolute;top:0;right:0;padding:5.25rem 4.5rem;transform-origin:top right;transform:scale(0.33)}.content{position:relative;margin-left:auto;margin-right:auto;padding:5rem 1rem 12rem}@media screen{.content{min-height:100vh}}@media screen and (min-width: 54em){.content{padding:4rem 1rem 12rem;margin-left:19rem;margin-right:3rem}}@media screen and (min-width: 72em){.content{max-width:42rem;margin-left:21rem}}@media screen and (min-width: 88em){.content{float:left;width:100%;margin-left:22rem;margin-right:5rem}}@media screen and (min-width: 96em){.content{max-width:44rem}}@media screen and (min-width: 102em){.content{margin-left:25rem;margin-right:8rem}}.me{width:6.5rem;height:6.5rem;align-self:center;margin-right:20px;border-radius:100%;position:relative}@media screen and (min-width: 40em){.me{width:7rem;height:7rem}}@media screen and (min-width: 54em){.me{width:6.5rem;height:6.5rem}}@media screen and (min-width: 72em){.me{width:7rem;height:7rem}}main>footer{width:100%;position:absolute;bottom:0;left:0;right:0;padding:0 1rem;color:#9a9a9a;font-size:smaller;text-align:center}main>footer>p{margin-bottom:0}html{font-family:'Sans-serif'}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-family:'Sans-serif'}

</style>


<link rel="preload" href="http://localhost:4003/assets/css/hydejack.css?v=6.4.0" as="style" onload="this.rel='stylesheet'">

<style id="_pageStyle">

.content a{color:#4f86aa;border-color:rgba(79,134,170,0.2)}.content a:hover{border-color:#4f86aa}:focus{outline-color:#4f86aa}::selection{color:#fff;background:#4f86aa}::-moz-selection{color:#fff;background:#4f86aa}

</style>


<noscript>
  <link rel="stylesheet" href="http://localhost:4003/assets/css/hydejack.css?v=6.4.0">
  
  
  

  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <style>
      html { font-family: 'Lato', 'Sans-serif' }
      h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Lato', 'Sans-serif' }
    </style>
  

  
  <link rel="stylesheet" href="http://localhost:4003/assets/icomoon/style.css">
</noscript>
<!--<![endif]-->

</head>

<body>
  <!-- =============== -->
<!-- MENU            -->
<!-- =============== -->
<div class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <a id="_menu" class="menu no-hover" href="#_title">
      <span class="sr-only">Menu</span>
    </a>
  </div>
</div>

<!-- =============== -->
<!-- CONTENT         -->
<!-- =============== -->
<div id="_yPushState">
  <div class="fade-in">
    <main id="_main" class="content" role="main" data-color="#4f86aa" data-image="/assets/img/nap.jpg">
      

<article id="post-paper/2018/06/21/vae3" class="post" role="article">
  <header>
    <h1 class="post-title">
      
        VAE Tutorial 3
      
    </h1>

    <p class="post-date heading">
      <time datetime="2018-06-21T00:00:00+09:00">21 Jun 2018</time>
      









in <a href="/category/paper/" data-flip="title">Paper</a>

      









on <a href="/tag/paper-dl/" data-flip="title">Deep-Learning</a>

    </p>

    <script data-ad-client="ca-pub-2252618542833203" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
  <div class="hr" style="padding-bottom:0"></div>


  </header>
  
    <!--
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  -->
  
    <div class="markdown-body">


        <!--
<style>
.myAd1190 { display:block; width:98%; height: 280px; }
@media(min-width: 600px) { .myAd1190 { display: none; } }
</style>
<ins class="adsbygoogle myAd1190"
    data-ad-client="ca-pub-5105555504153863"
    data-ad-slot="6481487416"
    ></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
-->


<br/>
      <ul>
  <li><strong>VAE Tutorial 목차</strong>
    <ul>
      <li><a href="https://dnddnjs.github.io/paper/2018/06/19/vae/">Tutorial 1: CS231n 강의 내용</a></li>
      <li><a href="https://dnddnjs.github.io/paper/2018/06/20/vae2/">Tutorial 2: VAE 논문 &amp; 코드 리뷰</a></li>
      <li><a href="https://dnddnjs.github.io/paper/2018/06/21/vae3/">Tutorial 3: SentenceVAE</a></li>
      <li><a href="https://dnddnjs.github.io/paper/2018/06/21/vae4/">Tutorial 4: MusicVAE</a></li>
    </ul>
  </li>
</ul>

<h1 id="vae-tutorial-3-sequencevae">VAE Tutorial 3: SequenceVAE</h1>

<p><img src="https://www.dropbox.com/s/hz7whkd5iv9n203/Screenshot%202018-06-21%2023.41.18.png?dl=1" /></p>

<ul>
  <li>논문 저자: Samuel R. Bowman (Stanford NLP group)</li>
  <li>논문 링크: <a href="https://arxiv.org/pdf/1511.06349.pdf">https://arxiv.org/pdf/1511.06349.pdf</a></li>
  <li>참고한 자료:
    <ul>
      <li><a href="https://arxiv.org/pdf/1803.05428.pdf">https://arxiv.org/pdf/1803.05428.pdf</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="1-introduction">1. Introduction</h2>
<p><a href="https://arxiv.org/pdf/1803.05428.pdf">MusicVAE 논문</a>의 introduction 내용을 참고했습니다.</p>

<p>Tutorial 1과 2에서 다룬 VAE는 generative model입니다. GAN과는 달리 모델의 explicit하게 학습할 수 있는 explicit density model 입니다. 또한 같은 explicit density model 중의 하나인 PixelCNN &amp; PixelRNN 과는 다르게 데이터의 의미있는 latent representation을 학습할 수 있습니다. 이 때 model은 Deep Neural Network를 사용해서 복잡한 transformation을 표현하도록 합니다. 따라서 VAE를 다른 이름으로는 deep latent variable model이라고도 부릅니다.</p>

<p>VAE는 이전 논문과 코드에서 살펴봤듯이 image를 생성하는데 초첨이 맞춰서 발전했습니다. VAE를 사용해서 여러 흥미로운 연구들이 이뤄졌습니다. 대부분은 VAE가 latent code를 학습하기 때문에 할 수 있는 것들입니다. 예를 들어 갈색 머리 사람의 사진을 모아서 encoder를 통과해 나온 latent vector를 평균 취하면 갈색 머리에 대한 “attribute vector”를 구할 수 있습니다. 만약 검은색 머리에 대한 attribute vector도 구했다면 재밌는 것을 할 수 있습니다. 다음 그림은 “Autoencoding beyond pixels using a learned similarity metric”이라는 논문에서 가져왔는데 attribute vector를 통해 input data를 변형시켜 새로운 data를 생성하는 것을 보여줍니다. 머리색이 변하기도 하고 성별이 변하기도 하며 수염이 생기기도 합니다.</p>

<p><img src="https://www.dropbox.com/s/5l4x0xu1kykpavw/Screenshot%202018-06-21%2014.43.53.png?dl=1" /></p>
<center>그림 출처 https://arxiv.org/pdf/1512.09300v1.pdf </center>

<p><br /></p>

<p>또한 latent space 상에서 서로 다른 두 latent vector의 interporlation을 통해 재밌는 실험을 할 수도 있습니다. 다음 그림은 “Deep Feature Consistent Variational Autoencoder” 논문에서 가져왔습니다. 그림의 왼쪽 사진에 대한 latent vector를 얻어내고 오른쪽 사진에 대한 latent vector를 얻어내면 <code class="MathJax_Preview">z_{new} = \alpha z_{left} + (1-\alpha) z_{right}</code><script type="math/tex">z_{new} = \alpha z_{left} + (1-\alpha) z_{right}</script>와 같은 식으로 linear interpolation으로 새로운 latent vector를 구할 수 있습니다. 다음 그림은 이 <code class="MathJax_Preview">\alpha</code><script type="math/tex">\alpha</script> 값을 0에서 1사이에서 변형시켜가며 그 latent vector를 decoder 통과시켰을 때 나온 이미지를 보여준 것입니다. continuous 하게 왼쪽 이미지에서 오른쪽 이미지로 변해가는 것을 볼 수 있습니다.</p>

<p><img src="https://www.dropbox.com/s/gp7xncdtri29ox7/Screenshot%202018-06-21%2015.21.02.png?dl=1" /></p>
<center>그림 출처 https://arxiv.org/pdf/1610.00291.pdf</center>

<p><br />
이러한 연구들은 대부분 이미지 데이터에 대해서 진행되었습니다. 하지만 최근 이와는 다르게 sequential data를 generation 하는 VAE에 대한 연구들도 이뤄지고 있습니다. Sequential한 data를 생성하기 위해서는 latent vector를 통해 data를 generate하는 decoder가 그냥 CNN이나 MLP가 아닌 RNN이나 PixelRNN 같은 autoregressive model을 사용해야 합니다(latent vector가 RNN에 대한 attention과 같이 작동한다고 생각하시면 이해가 쉬울지도 모르겠습니다 혹은 condition). 문제는 VAE의 decoder에 autoregressive model를 사용할 경우 latent code를 무시해버린다는 것입니다. 이러한 현상은 더 long sequence data를 생성할 때 더 명확히 드러납니다. decoder가 latent code를 무시하는 현상을 “posterior collapse”라고 합니다. 이 논문에서는 “posterior collapse” 문제를 해결하기 위해 ELBO의 KL term에 weight를 곱해주는 방법과 RNN(decoder)의 condition을 조정하는 방법을 사용했습니다.</p>

<p>sentence에 대해서도 image에서와 마찬가지로 latent vector interpolation을 테스트해볼 수 있습니다. 아래 사진은 “Generating Sentences from a Continuous Space” 논문에서 가져온 사진입니다. <strong>“ i want to talk to you . ”</strong>라는 문장의 latent vector와 <strong>she did n’t want to be with him .</strong> 라는 문장의 latent vector 사이를 linear 하게 interpolation 한 것입니다. 문장이 조금씩 변해가는 것을 볼 수 있습니다. 중요한 것은 모두 문법적으로 맞다는 것입니다. 이렇게 문장을 생성하면서 문장의 의미있는 representation을 학습하는 VAE 모델을 SentenceVAE라고 합니다. 이제 살펴보도록 하겠습니다.</p>

<center><img src="https://www.dropbox.com/s/r2bh3hkvdkw92do/Screenshot%202018-06-22%2011.13.03.png?dl=1" width="400px" /></center>
<center>그림 출처 https://arxiv.org/pdf/1511.06349.pdf</center>

<p><br /></p>

<hr />
<h2 id="2-a-vae-for-sentences">2. A VAE for sentences</h2>
<h3 id="21-recurrent-vae">2.1 Recurrent VAE</h3>
<p>(논문이 쓰여질 당시에)기존에 문장을 생성해내는 generative model 중에 state-of-art는 RNNLM(Recurrent Neural Network Language Model)이었습니다. Machine Translation, Image captioning과 같은 task에서 두각을 드러냈지만 문장의 global한 feature를 학습하지 못한다는 단점이 있었습니다. 따라서 이 논문은 VAE라는 새로운 네트워크를 통해 latent vector가 문장의 global feature를 나타내게 하겠다는 것이 목표입니다. RNNLM과 VAE를 적절히 합친다는 뜻입니다. VAE가 hidden latent variable로부터 data를 생성해내는데 여러 task에서 이미 보였듯이 의미있는 representation을 학습합니다. 따라서 RNNLM의 문제를 해결하는데 적절한 방법으로 보이는 것입니다. 다음은 이 논문에서 VAE를 설명하는 부분입니다. 이와같이 만들어낸 사람이 아닌 다른 사람의 해석을 보는 것이 직관력을 기르는데 도움이 됩니다.</p>

<blockquote>
  <p>The variational autoencoder (vae, Kingma and
Welling, 2015; Rezende et al., 2014) is a generative
model that is based on a regularized version
of the standard autoencoder. This model imposes
a prior distribution on the hidden codes z which
enforces a regular geometry over codes and makes
it possible to draw proper samples from the model
using ancestral sampling.
The vae modifies the autoencoder architecture
by replacing the deterministic function ϕenc with
a learned posterior recognition model, q(z|x). This
model parametrizes an approximate posterior distribution
over z (usually a diagonal Gaussian) with
a neural network conditioned on x. Intuitively, the
vae learns codes not as single points, but as soft
ellipsoidal regions in latent space, forcing the codes
to fill the space rather than memorizing the training
data as isolated codes.</p>
</blockquote>

<p>VAE의 학습 목표인 ELBO는 다음과 같습니다. 이 때, <code class="MathJax_Preview">g_{\phi}(\epsilon, x) = \mu + \sigma\epsilon</code><script type="math/tex">g_{\phi}(\epsilon, x) = \mu + \sigma\epsilon</script> 입니다(reparametization trick).</p>

<pre class="MathJax_Preview"><code>\mathcal{\tilde{L^B}}(x^{(i)}, \theta, \phi) = \frac{1}{L}\sum_{l=1}^L (log p_{\theta}(x^{(i)} \vert z^{(i, l)})) - D_{KL}(q_{\phi}(z \vert x^{(i)}) \Vert p_{\theta}(z))</code></pre>
<script type="math/tex; mode=display">\mathcal{\tilde{L^B}}(x^{(i)}, \theta, \phi) = \frac{1}{L}\sum_{l=1}^L (log p_{\theta}(x^{(i)} \vert z^{(i, l)})) - D_{KL}(q_{\phi}(z \vert x^{(i)}) \Vert p_{\theta}(z))</script>

<p>VAE를 sequence generation에 사용하기 위해 encoder와 decoder에 MLP가 아닌 single layer LSTM을 사용합니다. prior는 똑같이 gaussian 분포를 사용합니다. 이 gaussian prior는 ELBO의 KL term에 의해서 일종의 regularizer로 작용합니다. 그리고 latent code는 decoder에 condition으로 작용하며 generation 과정을 조절합니다. 이 모델의 구조는 다음과 같습니다. 문장은 단어 단위로 LSTM에 input으로 들어갑니다. 이 input은 word embedding의 output vector 입니다. 문장이 모두 끝까지 입력으로 들어가고 나면 hidden state의 값이 latent space 상에서 multivariate gaussian의 mean과 variance가 됩니다. 그러면 reparameterization trick을 사용해서 latent code z를 sampling 할 수 있습니다. 이 latent code가 decoder LSTM 모델의 initial hidden state가 되어 word space 상에서의 확률을 output으로 내보냅니다.</p>

<p><img src="https://www.dropbox.com/s/6islhw0mneo3to5/Screenshot%202018-06-22%2000.32.45.png?dl=1" /></p>

<p><br />
이 모델을 학습시키는데 있어서 challenge한 부분은 ELBO의 KL term 입니다. 만약 모델이 의미있는 latent code를 얻어내도록 학습이 되었다면 KL term은 0이 아닐 것이고(문장마다 다른 latent code를 생성하려면 prior와 posterior가 동일한 분포를 가지면 안됩니다) cross entropy term은 상대적으로 작을 것(reconstruction quality가 좋다)입니다. 하지만 위 모델을 그대로 구현해서 학습을 하면 KL term이 0이 되어버리는 문제가 생깁니다. 이렇게 되면 decoder가 문장을 생성할 때 latent code가 영향을 줄 수 없습니다(모든 문장이 동일한 latent code를 가진다고 생각해보세요).</p>

<p>KL term이 0이 되는 이유는 LSTM의 hidden state 입력이 확률적이기 때문이며 이러한 입력에 LSTM이 민감하기 때문입니다. 이런 경우 decoder는 latent를 무시해버리고 gradient는 encoder로 흘러가지 않습니다. 그러면 encoder는 오직 KL term에 의해서만 학습이 되기 때문에 KL term은 0이 되어버립니다. 이런 현상 즉, “posterior collapse”가 발생하면 VAE를 사용하는 의미가 없습니다. 이 문제를 해결하는 것이 중요합니다. 이 논문에서는 두 가지 방법을 제시합니다. (1) KL cost annealing (2) word dropout and historyless decoding 입니다.</p>

<p><br /></p>
<h3 id="22-kl-cost-annealing">2.2 KL cost annealing</h3>
<p>Posterior collapse 문제를 해결하기 위해 KL term에 곱해지는 weight variable을 도입합니다. 이 weight가 도입된 Objective 식은 다음과 같습니다. 단순히 <code class="MathJax_Preview">\beta</code><script type="math/tex">\beta</script>라는 weight를 KL에 곱해준 겁니다.</p>

<pre class="MathJax_Preview"><code>\mathcal{\tilde{L^B}}(x^{(i)}, \theta, \phi) = \frac{1}{L}\sum_{l=1}^L (log p_{\theta}(x^{(i)} \vert z^{(i, l)})) - \beta D_{KL}(q_{\phi}(z \vert x^{(i)}) \Vert p_{\theta}(z))</code></pre>
<script type="math/tex; mode=display">\mathcal{\tilde{L^B}}(x^{(i)}, \theta, \phi) = \frac{1}{L}\sum_{l=1}^L (log p_{\theta}(x^{(i)} \vert z^{(i, l)})) - \beta D_{KL}(q_{\phi}(z \vert x^{(i)}) \Vert p_{\theta}(z))</script>

<p>학습이 시작될 때 <code class="MathJax_Preview">\beta</code><script type="math/tex">\beta</script>는 0으로 setting 됩니다. 이렇게 되면 cross entropy 항만 남게 되므로 그냥 auto-encoder와 같은 형태가 됩니다. <code class="MathJax_Preview">\beta</code><script type="math/tex">\beta</script>를 0으로 놓는 것은 가능한 많은 정보를 latent에 담아내라는 것입니다. 학습이 진행됨에 따라 <code class="MathJax_Preview">\beta</code><script type="math/tex">\beta</script> 값을 점점 증가시킴으로서 latent code를 smooth하게 prior 분포로 묶어줍니다. 그리고 <code class="MathJax_Preview">\beta</code><script type="math/tex">\beta</script>가 1이 되면 원래 ELBO의 값이 되어서 일반적인 VAE가 됩니다. <code class="MathJax_Preview">beta</code><script type="math/tex">beta</script>를 0에서 1로 키우는 과정(파란선)은 아래 그림과 같이 sigmoid 함수의 형태로 scheduling 합니다. 이에 따라 KL term은 초반에 엄청 상승합니다. KL term의 영향이 적기 때문에 encoder는 제약없이 latent space 상에 representation을 형성하기 때문입니다. 하지만 점점 <code class="MathJax_Preview">\beta</code><script type="math/tex">\beta</script>가 1에 가까워지면 이 KL term은 줄어들어서 수렴합니다.</p>

<center><img src="https://www.dropbox.com/s/shv5n81ymvg8isv/Screenshot%202018-06-22%2001.21.11.png?dl=1" width="450px" /></center>

<p><br /></p>
<h3 id="23-word-dropout-and-historyless-decoding">2.3 Word dropout and historyless decoding</h3>
<p>word drop은 decoder를 약하게 만드는 방법입니다. 학습 과정 동안 decoder의 lstm은 이전 ground truth를 input으로 받는데 이러면 데이터 자체에 의존해서 다음 word를 생성합니다. 이 때, 이 ground truth의 일부를 (예를 들어 3 단어 중 1 단어) 무작위로 다른 단어로 바꾸는 것입니다. 그러면 decoder는 좀 더 latent vector에 의존해서 문장을 생성합니다. 전체 문장 중에 단어 몇 개를 바꿀 것인지는 새로운 parameter <code class="MathJax_Preview">k \in [0, 1]</code><script type="math/tex">k \in [0, 1]</script> 를 적용해서 조절합니다. SequenceVAE에 대해서 더 자세히 알기 위해 Code를 살펴보겠습니다.
<br /></p>

<hr />
<h2 id="4-code-review">4. Code Review</h2>

<hr />
<h2 id="3-experiment--conclusion">3. Experiment &amp; Conclusion</h2>
<h3 id="31-experiment">3.1 Experiment</h3>

<h3 id="32-conclusion">3.2 Conclusion</h3>

<p><br /></p>


      <br/>
      <br/>
        <!--블로그-하단-반응형
      <ins class="adsbygoogle"
          style="display:block; width:100%; height:300px;"
          data-ad-client="ca-pub-5105555504153863"
          data-ad-slot="1037589043"
          data-ad-format="auto"></ins>
      <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      -->
    </div>
  

</article>

  <hr class="dingbat" />

  <div class="share">
      <h2>Share this post</h2>
      <div class="share-body">
        <a href="http://twitter.com/share?text=VAE Tutorial 3&amp;url=http://localhost:4003/paper/2018/06/21/vae3/"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <span class="icon-twitter">
            </span>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4003/paper/2018/06/21/vae3/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <span class="icon-facebook">
            </span>
        </a>
    </div>
  </div>
  <br/>






  <aside class="author" role="complementary">
    <div class="author">
  <h2 class="page-title hr">
    About
  </h2>
<div class="author-body">
  
    
  

  

  <img
    src="/assets/img/me.jpeg"
    class="me"
    alt="woongwon lee"
    srcset="/assets/img/me.jpeg 1x,/assets/img/me.jpeg 2x"
    
  />


  
  <div class="author-body-description">
    <p>Machine Learning Engineer</p>

  </div>
</div>
</div>

  </aside>





<aside class="related" role="complementary">
  <h2 class="hr">Related Posts</h2>

  <ul class="related-posts">
    
      
      
      
        
        
          


<li class="h4">
  <a href="/paper/2018/10/14/arxiv_new/" data-flip="title">
    <span>Arxiv New 2018.10.14</span>
  </a>
  <small><time datetime="2018-10-14T00:00:00+09:00">
    14 Oct 2018
  </time></small>
</li>

        
      
        
        
          


<li class="h4">
  <a href="/paper/2018/07/29/nkn/" data-flip="title">
    <span>Neural Kinematic Networks for Unsupervised Motion Retargetting</span>
  </a>
  <small><time datetime="2018-07-29T00:00:00+09:00">
    29 Jul 2018
  </time></small>
</li>

        
      
        
        
          


<li class="h4">
  <a href="/paper/2018/07/19/youtube/" data-flip="title">
    <span>Playing hard exploration games by watching YouTube</span>
  </a>
  <small><time datetime="2018-07-19T00:00:00+09:00">
    19 Jul 2018
  </time></small>
</li>

        
      
        
        
      
    
  </ul>
</aside>



      
        <aside class="comments" role="complementary">
  <h2>Comments</h2>
  <hr/>

  <div id="disqus_thread"></div>

  <script>
    !function(s,i){function e(e){var t=s.pageYOffset||i.body.scrollTop;s.DISQUS&&!s._disqusThis&&!s._disqusFirst&&t+s.innerHeight>=s._disqusThreadOffsetTop&&(s._disqusThis=!0,s.DISQUS.reset({reload:!0,config:d}))}var d=function(){this.page.title="VAE Tutorial 3",this.page.identifier="/paper/2018/06/21/vae3",this.page.url="http://localhost:4003/paper/2018/06/21/vae3/"};s._disqusFirst=void 0===s._disqusFirst||s._disqusFirst,s._disqusLoading=void 0!==s._disqusLoading&&s._disqusLoading,s._disqusThis=!1,s._disqusThreadOffsetTop=i.getElementById("disqus_thread").offsetTop,s._disqusLoading?s._disqusFirst=!1:(s._disqusLoading=!0,loadJSDeferred("//dnddnjs.disqus.com/embed.js"),s.addEventListener?s.addEventListener("scroll",e,{passive:!0}):s.attachEvent?s.attachEvent("onscroll",e):s.onscroll=e)}(window,document);

  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</aside>

      

      <footer>
  <hr/>
  
    <p>© 2018. by Woongwon Lee</p>

  
  <p>
    <code>Powered by <a href="https://dnddnjs.github.io/">dnddnjs</a></code>
  </p>
</footer>

    </main>
    <!--<div class="right-side">
  <div class="ad-first">
    <!--
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- 블로그-상단-모바일
    <ins class="adsbygoogle"
         style="display:inline-block;width:100%;"
         data-ad-client="ca-pub-5105555504153863"
         data-ad-slot="9090558636"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    -->
  </div>
<br/>
<br/>
  <!--
  <div class="ad-second">
    <!-- 블로그-스카이스크래퍼
    <ins class="adsbygoogle"
         style="display:inline-block;max-width:320px;width:100%;height:600px"
         data-ad-client="ca-pub-5105555504153863"
         data-ad-slot="3646660262"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    -->
  </div>
</div>

-->
  </div>
  <div id="_yDrawer">
  <div id="_sidebar" class="sidebar">
    <div class="sidebar-bg" style="background-color:#4f86aa;background-image:url(/assets/img/nap.jpg)"></div>
    <header class="sidebar-sticky" role="banner">
      <br/>
      <div class="sidebar-about">
        <h1><a id="_title" href="/">Woongwon Lee</a></h1>
        <p>Machine Learning Engineer</p>

      </div>

      <br/>
      <br/>
      <nav class="sidebar-nav heading" role="navigation">
        <span class="sr-only">Navigation:</span>
<ul>
  

  

  
  
  
  
  
    <li>
      <input type="checkbox" id="list-item-1"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/paper/">Paper</a>
       <label class="folder" for="list-item-1">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/paper-rl/">Reinforcement-Learning</a>
             </li>
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/paper-dl/">Deep-Learning</a>
             </li>
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/paper-thinking/">Thinking</a>
             </li>
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-2"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/about/">About</a>
       
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
</ul>

      </nav>
    <br/>
    <br/>
      <div class="sidebar-box">
        
          
  

  

  <img
    src="/assets/img/me.jpeg"
    class="me"
    alt="woongwon lee"
    srcset="/assets/img/me.jpeg 1x,/assets/img/me.jpeg 2x"
    
  />


        
      </div>
      <p>Reinforce Yourself</p>

      
      
        <div class="sidebar-social">
          <span class="sr-only">Social:</span>
<ul>
  
    









<li>
  <a href="https://facebook.com/dnddnjs">
    <span class="icon-facebook" title="Facebook"></span>
    <span class="sr-only">Facebook</span>
  </a>
</li>

  
    









<li>
  <a href="https://github.com/dnddnjs">
    <span class="icon-github" title="GitHub"></span>
    <span class="sr-only">GitHub</span>
  </a>
</li>

  
    









<li>
  <a href="mailto:dnddnjs11@naver.com">
    <span class="icon-mail" title="Email"></span>
    <span class="sr-only">Email</span>
  </a>
</li>

  
</ul>

        </div>
      
    </header>
  </div>
</div>

</div>

<!-- =============== -->
<!-- SCRIPTS         -->
<!-- =============== -->

<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-120080215-1', 'auto');
  ga('send', 'pageview');
  loadJSDeferred('https://www.google-analytics.com/analytics.js');
</script>





<!--[if gt IE 8]><!---->
<script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
  WebFont.load({
    
    google: {
      families: 'Lato'.split('|')
    },
    

    custom: {
      families: ['icomoon'],
      urls: ['/assets/icomoon/style.css']
    }
  });
</script>
<!--<![endif]-->


  <!--[if gt IE 9]><!---->
  
  <script>loadJSDeferred('/assets/js/hydejack.js?v=6.4.0');</script>

  
  <!--<![endif]-->



</body>

</html>
